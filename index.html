<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صدقة جارية | زكريا أحمد محمد حسن</title>
    
    <!-- PWA & Mobile Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/192/islamic-art.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@400;600;700&family=Reem+Kufi:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        'reem': ['Reem Kufi', 'sans-serif'],
                        'cairo': ['Cairo', 'sans-serif'],
                        'amiri': ['Amiri', 'serif'],
                    },
                    colors: {
                        emerald: {
                            50: '#f0fdf4', 100: '#dcfce7', 200: '#bbf7d0', 300: '#86efac', 400: '#4ade80', 
                            500: '#10b981', 600: '#059669', 700: '#047857', 800: '#065f46', 900: '#064e3b',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Cairo', sans-serif; transition: background 0.3s; scroll-behavior: smooth; }
        .quran-font { font-family: 'Amiri', serif; line-height: 2.2; }
        .title-font { font-family: 'Reem Kufi', sans-serif; }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .dark .glass-card {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .nav-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
        .nav-card.active { 
            background: #10b981; 
            color: white !important; 
            transform: scale(1.05);
            box-shadow: 0 10px 20px -5px rgba(16, 185, 129, 0.4);
        }
        
        .section-content { display: none; }
        .section-content.active { display: block; animation: fadeIn 0.5s ease; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .profile-container {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            position: relative;
        }

        .profile-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            border: 4px solid #10b981;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.2);
        }

        .share-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        /* تحسين شكل المشغل كما في الصورة */
        .player-gradient {
            background: linear-gradient(135deg, #2d9d78 0%, #1a7a5c 100%);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100 min-h-screen">

    <!-- Header & Logo -->
    <header class="pt-12 pb-20 text-center px-4 relative overflow-hidden">
        <div class="profile-container">
            <!-- ملاحظة: استبدل هذا الرابط برابط الصورة المباشر لاحقاً -->
            <img src="https://ui-avatars.com/api/?name=Zakaria+Ahmed&background=10b981&color=fff&size=150" alt="زكريا أحمد" class="profile-image">
            <div class="absolute -bottom-2 -right-2 bg-white dark:bg-slate-800 p-2 rounded-full shadow-lg border border-emerald-100">
                <img src="https://img.icons8.com/fluency/30/islamic-art.png" alt="icon">
            </div>
        </div>
        <div class="container mx-auto relative z-10">
            <h1 class="text-3xl md:text-5xl font-bold title-font mb-4 text-emerald-900 dark:text-white">
                صدقة جارية لروح زكريا أحمد محمد حسن
            </h1>
            <p class="text-emerald-700 dark:text-emerald-400 font-medium quran-font text-xl italic">"يَا أَيَّتُهَا النَّفْسُ الْمُطْمَئِنَّةُ ارْجِعِي إِلَى رَبِّكِ رَاضِيَةً مَّرْضِيَّةً"</p>
        </div>
    </header>

    <!-- Navigation Hub -->
    <nav class="container mx-auto px-4 -mt-12 mb-10 sticky top-4 z-50">
        <div class="flex flex-wrap justify-center gap-3 max-w-5xl mx-auto">
            <div onclick="switchSection('azkar')" id="btn-azkar" class="nav-card active glass-card px-6 py-4 rounded-2xl shadow-sm flex items-center gap-3">
                <i class="fas fa-book-open text-emerald-600"></i>
                <span class="font-bold text-sm">الأذكار</span>
            </div>
            <div onclick="switchSection('listen')" id="btn-listen" class="nav-card glass-card px-6 py-4 rounded-2xl shadow-sm flex items-center gap-3">
                <i class="fas fa-headphones text-emerald-600"></i>
                <span class="font-bold text-sm">استماع القرآن</span>
            </div>
            <div onclick="switchSection('rosary')" id="btn-rosary" class="nav-card glass-card px-6 py-4 rounded-2xl shadow-sm flex items-center gap-3">
                <i class="fas fa-circle-notch text-emerald-600"></i>
                <span class="font-bold text-sm">مسبحة</span>
            </div>
            <div onclick="switchSection('read')" id="btn-read" class="nav-card glass-card px-6 py-4 rounded-2xl shadow-sm flex items-center gap-3">
                <i class="fas fa-quran text-emerald-600"></i>
                <span class="font-bold text-sm">المصحف</span>
            </div>
            <button onclick="openShare()" class="bg-emerald-600 text-white px-6 py-4 rounded-2xl shadow-lg flex items-center gap-3 hover:bg-emerald-700 transition-colors">
                <i class="fas fa-share-nodes"></i>
                <span class="font-bold text-sm">شارك الأجر</span>
            </button>
        </div>
    </nav>

    <main class="container mx-auto px-4 pb-20">
        
        <!-- الأذكار -->
        <section id="azkar" class="section-content active">
            <div class="max-w-4xl mx-auto">
                <div class="flex gap-2 mb-6 overflow-x-auto pb-2" id="azkarTabs">
                    <button onclick="loadAzkar('morning', this)" class="azkar-tab flex-1 whitespace-nowrap px-6 py-3 rounded-xl bg-emerald-600 text-white font-bold">الصباح</button>
                    <button onclick="loadAzkar('evening', this)" class="azkar-tab flex-1 whitespace-nowrap px-6 py-3 rounded-xl bg-white dark:bg-slate-800 font-bold border">المساء</button>
                    <button onclick="loadAzkar('sleep', this)" class="azkar-tab flex-1 whitespace-nowrap px-6 py-3 rounded-xl bg-white dark:bg-slate-800 font-bold border">النوم</button>
                </div>
                <div id="azkarContainer" class="grid gap-4"></div>
            </div>
        </section>

        <!-- المسبحة -->
        <section id="rosary" class="section-content">
            <div class="max-w-md mx-auto text-center glass-card p-10 rounded-[40px] shadow-xl border border-emerald-100 dark:border-slate-800">
                <p id="rosaryText" class="text-2xl quran-font text-emerald-800 dark:text-emerald-400 mb-8 min-h-[60px]">سُبْحَانَ اللَّهِ وَبِحَمْدِهِ</p>
                <div class="relative w-48 h-48 mx-auto mb-10 flex items-center justify-center">
                    <svg class="absolute inset-0 w-full h-full -rotate-90">
                        <circle cx="96" cy="96" r="88" stroke="currentColor" stroke-width="6" fill="transparent" class="text-slate-200 dark:text-slate-800" />
                        <circle id="rosaryCircle" cx="96" cy="96" r="88" stroke="#10b981" stroke-width="8" fill="transparent" stroke-dasharray="553" stroke-dashoffset="553" stroke-linecap="round" class="transition-all duration-300" />
                    </svg>
                    <span id="rosaryCount" class="text-6xl font-bold font-mono">0</span>
                </div>
                <button onclick="tapRosary()" class="w-full py-8 bg-emerald-600 hover:bg-emerald-700 text-white rounded-3xl shadow-xl active:scale-95 transition-all text-2xl font-bold mb-4">اضغط للتسبيح</button>
                <button onclick="resetRosary()" class="text-slate-400 hover:text-red-500 transition-colors">إعادة ضبط العداد</button>
            </div>
        </section>

        <!-- استماع القرآن الكريم -->
        <section id="listen" class="section-content">
            <h2 class="text-2xl font-bold text-center mb-8 title-font">استماع القرآن الكريم</h2>
            <div class="max-w-5xl mx-auto flex flex-col md:flex-row gap-6">
                
                <!-- مشغل الصوت المطور -->
                <div class="flex-grow player-gradient rounded-[40px] p-8 md:p-12 text-white shadow-2xl relative overflow-hidden flex flex-col justify-between min-h-[400px]">
                    <div class="relative z-10 text-center">
                        <h3 id="curSurah" class="text-4xl md:text-5xl quran-font font-bold mb-4 drop-shadow-md">سورة الفاتحة</h3>
                        <p id="curReciter" class="text-emerald-100 text-xl font-medium opacity-90">عبد الباسط عبد الصمد</p>
                    </div>

                    <!-- أيقونة زخرفية جانبية -->
                    <div class="absolute right-8 top-1/2 -translate-y-1/2 opacity-10 hidden md:block">
                         <i class="fas fa-quran text-[150px]"></i>
                    </div>

                    <div class="relative z-10 mt-12">
                        <div class="flex justify-between text-xs mb-2 text-emerald-100">
                            <span id="currentTime">00:00</span>
                            <span id="durationTime">00:00</span>
                        </div>
                        <input type="range" id="audioSeek" class="w-full h-1.5 mb-8 accent-white cursor-pointer opacity-80 hover:opacity-100 transition-opacity" value="0">
                        
                        <div class="flex justify-center items-center gap-10">
                            <button onclick="skip(-10)" class="text-2xl hover:text-emerald-300 transition-colors"><i class="fas fa-undo"></i></button>
                            <button id="mainPlayBtn" onclick="togglePlay()" class="w-20 h-20 bg-white text-emerald-900 rounded-full flex items-center justify-center text-3xl shadow-2xl hover:scale-110 transition-transform active:scale-95">
                                <i class="fas fa-play ml-1"></i>
                            </button>
                            <button onclick="skip(10)" class="text-2xl hover:text-emerald-300 transition-colors"><i class="fas fa-redo"></i></button>
                        </div>
                    </div>
                    <audio id="audioEngine"></audio>
                </div>

                <!-- قائمة التحكم -->
                <div class="md:w-80 glass-card rounded-[40px] p-6 shadow-xl border dark:border-slate-800 flex flex-col gap-6">
                    <div>
                        <label class="flex items-center gap-2 text-sm font-bold text-slate-500 mb-3 mr-1">
                            <i class="fas fa-user-tie text-emerald-600"></i> اختر القارئ
                        </label>
                        <select id="reciterDrop" onchange="updateReciterFromDrop()" class="w-full p-4 rounded-2xl border-2 border-slate-100 focus:border-emerald-500 outline-none dark:bg-slate-900 dark:border-slate-700 font-bold transition-all appearance-none"></select>
                    </div>

                    <div>
                        <label class="flex items-center gap-2 text-sm font-bold text-slate-500 mb-3 mr-1">
                            <i class="fas fa-list-ol text-emerald-600"></i> اختر السورة
                        </label>
                        <select id="surahDrop" onchange="changeSurah()" class="w-full p-4 rounded-2xl border-2 border-slate-100 focus:border-emerald-500 outline-none dark:bg-slate-900 dark:border-slate-700 font-bold transition-all appearance-none"></select>
                    </div>

                    <div class="mt-auto p-4 bg-emerald-50 dark:bg-emerald-900/20 rounded-2xl border border-emerald-100 dark:border-emerald-800">
                        <p class="text-xs text-emerald-700 dark:text-emerald-400 text-center leading-relaxed">
                            "الذي يقرأ القرآن وهو ماهر به مع السفرة الكرام البررة"
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- المصحف -->
        <section id="read" class="section-content">
            <div id="surahIndex" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            <div id="quranReader" class="hidden">
                <div class="max-w-4xl mx-auto glass-card rounded-[30px] overflow-hidden">
                    <div class="p-4 bg-emerald-600 text-white flex justify-between items-center">
                        <button onclick="closeQuran()"><i class="fas fa-times"></i></button>
                        <h4 id="readerTitle" class="title-font">سورة البقرة</h4>
                        <span></span>
                    </div>
                    <div id="ayahsBox" class="p-8 md:p-12 text-right quran-font text-2xl md:text-3xl leading-relaxed dark:text-slate-100 bg-[#fcfaf5] dark:bg-slate-900/50 min-h-[500px]"></div>
                </div>
            </div>
        </section>

    </main>

    <!-- Share Modal -->
    <div id="shareModal" class="share-modal" onclick="closeShare()">
        <div class="glass-card p-8 rounded-[30px] max-w-sm w-full m-4 text-center" onclick="event.stopPropagation()">
            <h3 class="text-2xl font-bold mb-4">شارك الصدقة الجارية</h3>
            <p class="text-slate-500 mb-6 text-sm">شارك هذا الموقع مع أصدقائك وأهلك لتكون شريكاً في الأجر بإذن الله.</p>
            <div class="grid grid-cols-2 gap-4">
                <button onclick="shareLink('wa')" class="p-4 bg-emerald-500 text-white rounded-2xl flex flex-col items-center gap-2">
                    <i class="fab fa-whatsapp text-2xl"></i>
                    <span>واتساب</span>
                </button>
                <button onclick="shareLink('fb')" class="p-4 bg-blue-600 text-white rounded-2xl flex flex-col items-center gap-2">
                    <i class="fab fa-facebook-f text-2xl"></i>
                    <span>فيسبوك</span>
                </button>
                <button onclick="copyLink()" class="col-span-2 p-4 bg-slate-100 dark:bg-slate-800 rounded-2xl flex items-center justify-center gap-3 font-bold">
                    <i class="fas fa-link"></i>
                    <span>نسخ رابط الموقع</span>
                </button>
            </div>
            <button onclick="closeShare()" class="mt-6 text-slate-400 text-sm underline">إغلاق</button>
        </div>
    </div>

    <footer class="bg-white dark:bg-slate-900 border-t py-12 text-center">
        <div class="container mx-auto px-4">
            <p class="quran-font text-2xl text-emerald-600 mb-4">اللهم تقبل هذا العمل خالصاً لوجهك الكريم</p>
            <p class="text-slate-500 text-sm mb-6 max-w-md mx-auto">هذا الموقع تم برمجته ليكون صدقة جارية مستمرة لروح زكريا أحمد محمد حسن، نرجو منكم الدعاء له بالرحمة والمغفرة.</p>
            <button onclick="toggleDarkMode()" class="p-3 rounded-full bg-slate-100 dark:bg-slate-800 text-emerald-600">
                <i id="themeIcon" class="fas fa-moon"></i>
            </button>
        </div>
    </footer>

    <script>
        // -- Data --
        const surahNames = ["الفاتحة","البقرة","آل عمران","النساء","المائدة","الأنعام","الأعراف","الأنفال","التوبة","يونس","هود","يوسف","الرعد","إبراهيم","الحجر","النحل","الإسراء","الكهف","مريم","طه","الأنبياء","الحج","المؤمنون","النور","الفرقان","الشعراء","النمل","القصص","العنكبوت","الروم","لقمان","السجدة","الأحزاب","سبأ","فاطر","يس","الصافات","ص","الزمر","غافر","فصلت","الشورى","الزخرف","الدخان","الجاثية","الأحقاف","محمد","الفتح","الحجرات","ق","الذاريات","الطور","النجم","القمر","الرحمن","الواقعة","الحديد","المجادلة","الحشر","الممتحنة","الصف","الجمعة","المنافقون","التغابن","الطلاق","التحريم","الملك","القلم","الحاقة","المعارج","نوح","الجن","المزمل","المدثر","القيامة","الإنسان","المرسلات","النبأ","النازعات","عبس","التكوير","الانفطار","المطففين","الانشقاق","البروج","الطارق","الأعلى","الغاشية","الفجر","البلد","الشمس","الليل","الضحى","الشرح","التين","العلق","القدر","البينة","الزلزلة","العاديات","القارعة","التكاثر","العصر","الهمزة","الفيل","قريش","الماعون","الكوثر","الكافرون","النصر","المسد","الإخلاص","الفلق","الناس"];
        
        const reciters = [
            { id: 'bs', name: 'عبد الباسط عبد الصمد', url: 'https://server7.mp3quran.net/basit/' },
            { id: 'ar', name: 'مشاري العفاسي', url: 'https://server8.mp3quran.net/afs/' },
            { id: 'sh', name: 'سعود الشريم', url: 'https://server7.mp3quran.net/shur/' },
            { id: 'ma', name: 'ماهر المعيقلي', url: 'https://server4.mp3quran.net/hlw/' }
        ];

        const azkarData = {
            morning: [
                { t: "آية الكرسي: اللَّهُ لَا إِلَهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ...", c: 1 },
                { t: "أصبحنا وأصبح الملك لله، والحمد لله، لا إله إلا الله وحده لا شريك له..", c: 1 },
                { t: "اللهم بك أصبحنا، وبك أمسينا، وبك نحيا، وبك نموت، وإليك النشور.", c: 1 },
                { t: "سُبْحَانَ اللهِ وَبِحَمْدِهِ: عَدَدَ خَلْقِهِ، وَرِضَا نَفْسِهِ، وَزِنَةَ عَرْشِهِ، وَمِدَادَ كَلِمَاتِهِ.", c: 3 }
            ],
            evening: [
                { t: "أمسينا وأمسى الملك لله، والحمد لله، لا إله إلا الله وحده لا شريك له..", c: 1 },
                { t: "باسم الله الذي لا يضر مع اسمه شيء في الأرض ولا في السماء..", c: 3 },
                { t: "رضيت بالله رباً وبالإسلام ديناً وبمحمد صلى الله عليه وسلم نبياً.", c: 3 },
                { t: "أعوذ بكلمات الله التامات من شر ما خلق.", c: 3 }
            ],
            sleep: [
                { t: "باسمك ربي وضعت جنبي وبك أرفعه..", c: 1 },
                { t: "اللهم قني عذابك يوم تبعث عبادك.", c: 3 },
                { t: "سبحان الله (33)، الحمد لله (33)، الله أكبر (34).", c: 1 }
            ]
        };

        // -- Navigation --
        function switchSection(id) {
            document.querySelectorAll('.section-content').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            document.querySelectorAll('.nav-card').forEach(n => n.classList.remove('active'));
            document.getElementById(`btn-${id}`).classList.add('active');
            
            if(id === 'listen' && !document.getElementById('reciterDrop').children.length) initAudio();
            if(id === 'read' && !document.getElementById('surahIndex').children.length) initQuran();
            if(id === 'azkar') loadAzkar('morning');
        }

        // -- Azkar --
        function loadAzkar(type, btn) {
            const cont = document.getElementById('azkarContainer');
            if(btn) {
                document.querySelectorAll('.azkar-tab').forEach(b => {
                    b.classList.remove('bg-emerald-600', 'text-white');
                    b.classList.add('bg-white', 'dark:bg-slate-800');
                });
                btn.classList.add('bg-emerald-600', 'text-white');
                btn.classList.remove('bg-white', 'dark:bg-slate-800');
            }
            
            cont.innerHTML = "";
            azkarData[type].forEach((a, i) => {
                const id = `zkr-${type}-${i}`;
                const card = document.createElement('div');
                card.className = "glass-card p-6 rounded-2xl border dark:border-slate-800 shadow-sm relative overflow-hidden";
                card.id = id;
                card.innerHTML = `
                    <p class="text-xl quran-font mb-6 text-right">${a.t}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-xs bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400 px-3 py-1 rounded-full font-bold">العدد: ${a.c}</span>
                        <button onclick="countZekr('${id}', ${a.c})" class="btn-count w-14 h-14 rounded-full border-2 border-emerald-500 text-emerald-600 font-bold text-lg flex items-center justify-center transition-all hover:bg-emerald-600 hover:text-white">0</button>
                    </div>
                `;
                cont.appendChild(card);
            });
        }

        function countZekr(id, limit) {
            const btn = document.querySelector(`#${id} .btn-count`);
            let count = parseInt(btn.innerText) || 0;
            if(count < limit) {
                count++;
                btn.innerText = count;
                if(count === limit) {
                    btn.innerHTML = '<i class="fas fa-check"></i>';
                    btn.classList.add('bg-emerald-600', 'text-white');
                    document.getElementById(id).style.opacity = "0.5";
                }
            }
        }

        // -- Rosary --
        function tapRosary() {
            const countEl = document.getElementById('rosaryCount');
            const circle = document.getElementById('rosaryCircle');
            let count = parseInt(countEl.innerText);
            count++;
            countEl.innerText = count;
            
            const progress = (count % 33) / 33;
            circle.style.strokeDashoffset = 553 - (progress * 553);
            
            if(count % 33 === 0) {
                const phrases = ["سُبْحَانَ اللَّهِ وَبِحَمْدِهِ", "الْحَمْدُ لِلَّهِ", "اللَّهُ أَكْبَرُ", "لا إِلَهَ إِلا اللَّهُ"];
                document.getElementById('rosaryText').innerText = phrases[Math.floor(Math.random() * phrases.length)];
                if (window.navigator.vibrate) window.navigator.vibrate(50);
            }
        }

        function resetRosary() {
            document.getElementById('rosaryCount').innerText = "0";
            document.getElementById('rosaryCircle').style.strokeDashoffset = 553;
        }

        // -- Audio --
        const audio = document.getElementById('audioEngine');
        let currentReciter = reciters[0];

        function initAudio() {
            const reciterDrop = document.getElementById('reciterDrop');
            const surahDrop = document.getElementById('surahDrop');
            
            reciters.forEach((r, idx) => {
                const opt = document.createElement('option');
                opt.value = idx;
                opt.innerText = r.name;
                reciterDrop.appendChild(opt);
            });

            surahNames.forEach((n, i) => {
                const opt = document.createElement('option');
                opt.value = (i+1).toString().padStart(3, '0');
                opt.innerText = `${(i+1).toString().padStart(3, '0')} - سورة ${n}`;
                surahDrop.appendChild(opt);
            });
        }

        function updateReciterFromDrop() {
            const idx = document.getElementById('reciterDrop').value;
            currentReciter = reciters[idx];
            changeSurah();
        }

        function changeSurah() {
            const sid = document.getElementById('surahDrop').value;
            audio.src = `${currentReciter.url}${sid}.mp3`;
            document.getElementById('curSurah').innerText = `سورة ${surahNames[parseInt(sid)-1]}`;
            document.getElementById('curReciter').innerText = currentReciter.name;
            audio.play();
            document.getElementById('mainPlayBtn').innerHTML = '<i class="fas fa-pause"></i>';
        }

        function togglePlay() {
            if(!audio.src) { changeSurah(); return; }
            if(audio.paused) { audio.play(); document.getElementById('mainPlayBtn').innerHTML = '<i class="fas fa-pause"></i>'; }
            else { audio.pause(); document.getElementById('mainPlayBtn').innerHTML = '<i class="fas fa-play ml-1"></i>'; }
        }

        function formatTime(sec) {
            if(!sec) return "00:00";
            let m = Math.floor(sec / 60);
            let s = Math.floor(sec % 60);
            return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        audio.ontimeupdate = () => {
            if(!audio.duration) return;
            const seek = document.getElementById('audioSeek');
            seek.max = audio.duration;
            seek.value = audio.currentTime;
            document.getElementById('currentTime').innerText = formatTime(audio.currentTime);
            document.getElementById('durationTime').innerText = formatTime(audio.duration);
        };

        function skip(v) { audio.currentTime += v; }

        // -- Quran --
        function initQuran() {
            const index = document.getElementById('surahIndex');
            surahNames.forEach((n, i) => {
                const card = document.createElement('div');
                card.className = "glass-card p-5 rounded-2xl cursor-pointer border hover:border-emerald-500 transition-all flex items-center gap-4";
                card.innerHTML = `<span class="w-8 h-8 rounded-lg bg-emerald-50 dark:bg-emerald-900/30 text-emerald-600 flex items-center justify-center font-bold text-xs">${i+1}</span> <h5 class="font-bold quran-font">سورة ${n}</h5>`;
                card.onclick = () => loadSurah(i+1, n);
                index.appendChild(card);
            });
        }

        async function loadSurah(id, name) {
            document.getElementById('surahIndex').classList.add('hidden');
            document.getElementById('quranReader').classList.remove('hidden');
            document.getElementById('readerTitle').innerText = `سورة ${name}`;
            const box = document.getElementById('ayahsBox');
            box.innerHTML = "جاري التحميل...";
            
            try {
                const res = await fetch(`https://api.alquran.cloud/v1/surah/${id}`);
                const d = await res.json();
                box.innerHTML = d.data.ayahs.map(a => `${a.text} <span class="text-emerald-500 inline-block px-2 text-sm font-sans">[${a.numberInSurah}]</span>`).join(" ");
            } catch(e) { box.innerHTML = "حدث خطأ في الاتصال بالشبكة."; }
        }

        function closeQuran() {
            document.getElementById('quranReader').classList.add('hidden');
            document.getElementById('surahIndex').classList.remove('hidden');
        }

        // -- Theme & Utility --
        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            document.getElementById('themeIcon').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
        }

        function openShare() { document.getElementById('shareModal').style.display = 'flex'; }
        function closeShare() { document.getElementById('shareModal').style.display = 'none'; }
        
        function copyLink() {
            const url = window.location.href;
            const input = document.createElement('textarea');
            input.value = url;
            document.body.appendChild(input);
            input.select();
            document.execCommand('copy');
            document.body.removeChild(input);
            alert("تم نسخ الرابط.. شاركه ولك الأجر!");
        }

        function shareLink(type) {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent("صدقة جارية لروح زكريا أحمد محمد حسن.. المصحف والأذكار والاستماع بصوت كبار القراء.");
            let link = type === 'wa' ? `https://wa.me/?text=${text}%20${url}` : `https://www.facebook.com/sharer/sharer.php?u=${url}`;
            window.open(link, '_blank');
        }

        window.onload = () => { loadAzkar('morning'); };
    </script>
</body>
</html>
